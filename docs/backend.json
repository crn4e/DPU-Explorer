{
  "entities": {
    "Location": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Location",
      "type": "object",
      "description": "Represents a specific location on the DPU campus.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Location entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the location (e.g., Building A, Cafeteria 1)."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the location."
        },
        "locationType": {
          "type": "string",
          "description": "The type of location (e.g., academic building, cafeteria, gym)."
        },
        "latitude": {
          "type": "number",
          "description": "Latitude coordinate of the location."
        },
        "longitude": {
          "type": "number",
          "description": "Longitude coordinate of the location."
        },
        "openingHours": {
          "type": "string",
          "description": "Stringified JSON representation of the location's opening hours for each day of the week."
        },
        "isOpen": {
          "type": "boolean",
          "description": "Indicates whether the location is currently open."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "locationType",
        "latitude",
        "longitude",
        "openingHours",
        "isOpen"
      ]
    },
    "Announcement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Announcement",
      "type": "object",
      "description": "Represents an announcement related to a specific location.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Announcement entity."
        },
        "locationId": {
          "type": "string",
          "description": "Reference to Location. (Relationship: Location 1:N Announcement)"
        },
        "title": {
          "type": "string",
          "description": "The title of the announcement."
        },
        "content": {
          "type": "string",
          "description": "The content of the announcement."
        },
        "date": {
          "type": "string",
          "description": "The date of the announcement.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "locationId",
        "title",
        "content",
        "date"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/locations/{locationId}",
        "definition": {
          "entityName": "Location",
          "schema": {
            "$ref": "#/backend/entities/Location"
          },
          "description": "Stores location details. Accessible to all users for reading. Admins can create, update, and delete.",
          "params": [
            {
              "name": "locationId",
              "description": "Unique identifier for the location."
            }
          ]
        }
      },
      {
        "path": "/locations/{locationId}/announcements/{announcementId}",
        "definition": {
          "entityName": "Announcement",
          "schema": {
            "$ref": "#/backend/entities/Announcement"
          },
          "description": "Stores announcements related to a specific location. Accessible to all users for reading. Admins can create, update, and delete.",
          "params": [
            {
              "name": "locationId",
              "description": "Unique identifier for the parent location."
            },
            {
              "name": "announcementId",
              "description": "Unique identifier for the announcement."
            }
          ]
        }
      },
      {
        "path": "/admins/{uid}",
        "definition": {
          "entityName": "admin",
          "schema": {
            "$ref": "#/backend/entities/user"
          },
          "description": "Stores admin user IDs. The existence of a document with a user's ID in this collection grants admin privileges.",
          "params": [
            {
              "name": "uid",
              "description": "Firebase Authentication UID of the administrator."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the DPU Explorer application, focusing on displaying location details, announcements, and enabling admin content updates. The structure prioritizes authorization independence and clarity for secure and scalable operations.\n\n**Authorization Independence:**\n\n*   **Locations:** While admin updates are a key feature, the structure does not directly reflect admin roles within the location documents themselves. Instead, a separate `/admins/{uid}` collection manages admin privileges (see below).\n*   **Announcements:** Announcements are linked to locations via the `locationId` field. There's no user-specific ownership of announcements; they are managed centrally by admins.\n\n**Structural Segregation (Homogeneous Security Posture):**\n\n*   `/locations` collection stores all location documents with a uniform security posture. Admins can update these locations.\n*   `/locations/{locationId}/announcements` subcollection holds announcements related to specific locations.\n*   `/admins/{uid}` collection is used to store admin user IDs. The existence of a document in this collection grants admin privileges.\n\n**Access Modeling:**\n\n*   **Admin Roles:** Global admin roles are managed using the existence of a document in the `/admins/{uid}` collection. This avoids custom claims and simplifies rules.\n\n**QAPs (Rules are not Filters):**\n\n*   The structure enables secure `list` operations. Rules will allow listing locations and announcements based on admin privileges.\n\n**Invariants:**\n\n*   The structure supports the integrity of the `locationId` reference in announcements. Security rules can enforce that `locationId` exists in the `/locations` collection.\n\nThis design ensures that authorization checks are simple, robust, and easily debuggable, adhering to the core design principles outlined."
  }
}